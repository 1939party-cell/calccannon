
---
import fs from 'node:fs';

// read site + list of calculators generated by the build scripts
const site = JSON.parse(fs.readFileSync('./config/site.json', 'utf8'));
const all = JSON.parse(fs.readFileSync('./generated/calculators.json', 'utf8'));

// group by category and sort
const groups = all.reduce((acc, m) => {
  (acc[m.category] ||= []).push(m);
  return acc;
}, {});
for (const k of Object.keys(groups)) {
  groups[k].sort((a,b) => a.title.localeCompare(b.title));
}
const categories = Object.keys(groups).sort((a,b) => a.localeCompare(b));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{site.brand} â€” fast calculators</title>
    <meta name="description" content="Browse all calculators. Finance, conversions, and more." />
    <style>
      body{font-family:system-ui,Segoe UI,Arial,sans-serif;max-width:960px;margin:2rem auto;padding:0 1rem}
      header{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap}
      h1{margin:0}
      input[type="search"]{padding:.6rem;border:1px solid #ddd;border-radius:8px;min-width:260px}
      .cat{margin:1.5rem 0}
      .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:.6rem}
      .card{padding:.7rem;border:1px solid #eee;border-radius:10px;text-decoration:none}
      .card:hover{background:#fafafa}
      footer{margin-top:2rem;padding-top:1rem;border-top:1px solid #eee;font-size:.95rem}
    </style>
  </head>
  <body>
    <header>
      <h1>{site.brand}</h1>
      <input id="q" type="search" placeholder="Search calculators..." />
    </header>

    {categories.map(cat => (
      <section class="cat" data-cat={cat}>
        <h2>{cat}</h2>
        <div class="grid">
          {groups[cat].map(m => (
            <a class="card" href={"/calc/" + m.id} data-title={m.title.toLowerCase()}>
              <strong>{m.title}</strong><br/>
              <small>{m.description || ''}</small>
            </a>
          ))}
        </div>
      </section>
    ))}

    <footer>
      Tip via Cash App: <a href={`https://cash.app/${site.cashApp.cashtag}`} target="_blank" rel="noopener">
        ${site.cashApp.cashtag}
      </a>
    </footer>

    <script type="module">
      const q = document.getElementById('q');
      q?.addEventListener('input', () => {
        const term = q.value.trim().toLowerCase();
        document.querySelectorAll('.card').forEach(el => {
          const match = el.getAttribute('data-title').includes(term);
          el.style.display = match ? '' : 'none';
        });
      });
    </script>
  </body>
</html>
